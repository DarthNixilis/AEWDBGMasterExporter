<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AEW DBG Master Exporter</title>
  <link rel="stylesheet" href="./style.css" />

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    header { padding: 12px; border-bottom: 1px solid #ddd; position: sticky; top: 0; background: #fff; z-index: 10; }
    #statusLine { font-size: 14px; color: #222; }
    main { padding: 16px; max-width: 1100px; margin: 0 auto; }

    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .col { display:flex; flex-direction:column; gap:6px; }
    label { font-weight: 800; }
    select, button, input { font-size: 16px; padding: 10px 12px; }
    input { min-width: min(520px, calc(100vw - 40px)); }
    .muted { color: #666; }

    h2 { margin-top: 22px; margin-bottom: 10px; }
    h3 { margin: 14px 0 8px; }

    .card { border: 1px solid #ddd; border-radius: 12px; padding: 10px; background: #fff; }
    .pill { display:inline-block; border:1px solid #ddd; border-radius:999px; padding:2px 8px; font-size:12px; margin-right:6px; margin-bottom:6px; color:#333; }
    .cardTitle { font-weight: 900; font-size: 16px; margin-bottom: 6px; }
    .cardMeta { margin-bottom: 6px; }
    .cardText { white-space: pre-wrap; word-break: break-word; font-size: 13px; line-height: 1.35; }
    .cardSmall { font-size: 12px; }

    .window {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 10px;
      background: #fafafa;
      max-height: 62vh;
      overflow: auto;
    }
    .deckWindow {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 10px;
      background: #fff;
      max-height: 48vh;
      overflow: auto;
    }

    /* Up to 3 columns: 1 on small, 2 on medium, 3 on large */
    .grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 1040px) { .grid { grid-template-columns: 1fr 1fr 1fr; } }

    .divider { height: 1px; background: #eee; margin: 16px 0; }
    .btnRow { display:flex; gap:8px; flex-wrap: wrap; margin-top: 10px; }

    .toastWrap {
      position: fixed; left: 0; right: 0; bottom: 0;
      display: flex; justify-content: center; pointer-events: none;
      padding: 10px; z-index: 9999;
    }
    .toast {
      pointer-events: auto;
      width: min(620px, calc(100vw - 20px));
      background: #111; color: #fff;
      border-radius: 14px;
      padding: 12px 12px 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .toastHead { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .toastTitle { font-weight: 800; }
    .toastBtns { display: flex; gap: 8px; }
    .toastBtns button { padding: 8px 10px; border-radius: 10px; border: 0; }
    .toast pre { margin: 10px 0 0; font-size: 12px; white-space: pre-wrap; word-break: break-word; max-height: 45vh; overflow: auto; }
  </style>
</head>

<body>
  <header>
    <div style="font-size: 22px; font-weight: 900;">Deck Starting</div>
    <div style="font-size: 12px; color:#666; font-weight:700;">BUILD: 2026-01-06 / 3-col grid + trait filter + damage</div>
    <div id="statusLine">Status: Loading…  Sets: (loading)  Cards: (loading)</div>
  </header>

  <main>
    <p class="muted">
      Pick Personas. Starter/Kit cards auto-load using <b>Starting For</b>. Kit cards never appear in Card Pool.
    </p>

    <div class="row">
      <div class="col">
        <label for="wrestlerSelect">Wrestler</label>
        <select id="wrestlerSelect"><option value="">(loading…)</option></select>
      </div>
      <div class="col">
        <label for="managerSelect">Manager</label>
        <select id="managerSelect"><option value="">(loading…)</option></select>
      </div>
      <div class="col">
        <label for="callNameSelect">Call Name</label>
        <select id="callNameSelect"><option value="">(loading…)</option></select>
      </div>
      <div class="col">
        <label for="factionSelect">Faction</label>
        <select id="factionSelect"><option value="">(loading…)</option></select>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button id="clearPersonasBtn" type="button">Clear Personas</button>
      </div>
    </div>

    <div class="divider"></div>

    <h2>Deck Builder</h2>
    <p class="muted" id="deckRulesLine">
      Starting Draw Deck: exactly 24 cards (Cost 0 only), max 2 copies per card in Starting.
      Purchase Deck: at least 36 cards. Max 3 copies total across both decks. Only 1 Finisher total.
    </p>

    <div class="row">
      <button id="copyDeckBtn" type="button">Copy deck list</button>
      <button id="copyDeckJsonBtn" type="button">Copy deck JSON</button>
      <button id="clearDeckBtn" type="button">Clear deck</button>
      <span class="muted" id="deckStatusLine"></span>
    </div>

    <div class="row" style="align-items:flex-start; gap:16px; margin-top: 10px;">
      <div style="flex:1; min-width: 320px;">
        <h3>Starting Draw Deck (<span id="startCount">0</span>/24)</h3>
        <div id="startDeckWindow" class="deckWindow"></div>
      </div>
      <div style="flex:1; min-width: 320px;">
        <h3>Purchase Deck (<span id="purchaseCount">0</span> / 36+)</h3>
        <div id="purchaseDeckWindow" class="deckWindow"></div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="col">
      <label for="searchInput">Search Card Pool (name + game text)</label>
      <input id="searchInput" type="search" placeholder="Try: momentum, submission, cheap pop…" />
    </div>

    <div class="row" style="margin-top:10px;">
      <div class="col">
        <label for="typeFilter">Type</label>
        <select id="typeFilter"><option value="">All</option></select>
      </div>
      <div class="col">
        <label for="traitFilter">Trait</label>
        <select id="traitFilter"><option value="">All</option></select>
      </div>
      <div class="col">
        <label for="setFilter">Set</label>
        <select id="setFilter"><option value="">All</option></select>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button id="clearFiltersBtn" type="button">Clear Filters</button>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button id="showMoreBtn" type="button">Show more</button>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <span class="muted" id="poolSummary"></span>
      </div>
    </div>

    <h2>Starter / Kit cards for selected Personas</h2>
    <div id="starterWindow" class="window">
      <div id="starterGrid" class="grid"></div>
    </div>

    <h2>General Card Pool</h2>
    <div id="poolWindow" class="window">
      <div id="poolGrid" class="grid">
        <div class="muted">Loading…</div>
      </div>
    </div>
  </main>

  <div class="toastWrap" id="toastWrap" style="display:none;">
    <div class="toast">
      <div class="toastHead">
        <div>
          <div class="toastTitle" id="toastTitle">App Error</div>
          <div class="muted" id="toastTime" style="color:#bbb;font-size:12px;"></div>
        </div>
        <div class="toastBtns">
          <button id="toastCopyBtn" type="button">Copy</button>
          <button id="toastCloseBtn" type="button">Close</button>
        </div>
      </div>
      <pre id="toastBody"></pre>
    </div>
  </div>

  <script>
    // FILE: index.html
    (function () {
      var statusLine = document.getElementById("statusLine");

      function setStatus(text) {
        if (statusLine) statusLine.textContent = text;
      }

      var toastWrap = document.getElementById("toastWrap");
      var toastTitle = document.getElementById("toastTitle");
      var toastTime = document.getElementById("toastTime");
      var toastBody = document.getElementById("toastBody");
      var toastCopyBtn = document.getElementById("toastCopyBtn");
      var toastCloseBtn = document.getElementById("toastCloseBtn");

      function showToast(title, body) {
        toastTitle.textContent = title || "App Error";
        toastTime.textContent = new Date().toLocaleTimeString();
        toastBody.textContent = body || "";
        toastWrap.style.display = "flex";

        toastCopyBtn.onclick = async function () {
          var text = toastTitle.textContent + "\n\n" + toastBody.textContent;
          try { await navigator.clipboard.writeText(text); } catch (e) {}
        };
        toastCloseBtn.onclick = function () { toastWrap.style.display = "none"; };
      }

      function showError(title, err) {
        var msg = err && err.stack ? err.stack : String(err || "");
        setStatus("Status: ERROR (see popup)  Sets: (loading)  Cards: (loading)");
        try { showToast(title || "App Error", msg); }
        catch (e) { alert((title || "App Error") + "\n\n" + msg); }
      }

      window.AEWDBG = { setStatus: setStatus, showError: showError };

      window.addEventListener("error", function (ev) {
        showError("Uncaught error", ev.error || ev.message || ev);
      });
      window.addEventListener("unhandledrejection", function (ev) {
        showError("Unhandled rejection", ev.reason || ev);
      });

      (async function () {
        setStatus("Status: Loading…  Sets: (loading)  Cards: (loading)");
        try {
          var mod = await import("./renderer.js");
          if (!mod || typeof mod.initApp !== "function") {
            throw new Error("renderer.js loaded, but did not export initApp()");
          }
          await mod.initApp();
        } catch (e) {
          showError("Boot failed (module load/import).", e);
        }
      })();
    })();
  </script>
</body>
</html>
