<!-- FILE: index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AEW TCG Deck Builder</title>
  <link rel="stylesheet" href="./style.css" />

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    header { padding: 12px; border-bottom: 1px solid #ddd; position: sticky; top: 0; background: #fff; z-index: 10; }
    #statusLine { font-size: 14px; color: #222; }
    main { padding: 16px; max-width: 980px; margin: 0 auto; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .col { display:flex; flex-direction:column; gap:6px; }
    label { font-weight: 800; }
    select, button, input { font-size: 16px; padding: 10px 12px; }
    input { min-width: min(520px, calc(100vw - 40px)); }
    .muted { color: #666; }
    h2 { margin-top: 26px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 10px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 10px; background: #fff; }
    .pill { display:inline-block; border:1px solid #ddd; border-radius:999px; padding:2px 8px; font-size:12px; margin-right:6px; color:#333; }
    .cardTitle { font-weight: 900; font-size: 16px; margin-bottom: 6px; }
    .cardMeta { margin-bottom: 8px; }
    .cardText { white-space: pre-wrap; word-break: break-word; font-size: 13px; line-height: 1.35; }
    .cardSmall { font-size: 12px; }
    .spacer { height: 8px; }

    .toastWrap {
      position: fixed; left: 0; right: 0; bottom: 0;
      display: flex; justify-content: center; pointer-events: none;
      padding: 10px; z-index: 9999;
    }
    .toast {
      pointer-events: auto;
      width: min(620px, calc(100vw - 20px));
      background: #111; color: #fff;
      border-radius: 14px;
      padding: 12px 12px 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .toastHead { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .toastTitle { font-weight: 800; }
    .toastBtns { display: flex; gap: 8px; }
    .toastBtns button { padding: 8px 10px; border-radius: 10px; border: 0; }
    .toast pre { margin: 10px 0 0; font-size: 12px; white-space: pre-wrap; word-break: break-word; max-height: 45vh; overflow: auto; }
  </style>
</head>

<body>
  <header>
    <div style="font-size: 22px; font-weight: 900;">Persona <span class="muted" style="font-weight:600;">Card Pool Deck Starting</span></div>
    <div id="statusLine">Status: Loading…  Sets: (loading)  Cards: (loading)</div>
  </header>

  <main>
    <p class="muted">
      Pick a Persona. Their Starter cards (including Kit cards) auto-load using <b>Starting For</b>.
      Kit cards never appear in Card Pool.
    </p>

    <div class="row" style="margin: 12px 0 6px;">
      <label for="personaSelect">Choose Persona:</label>
      <select id="personaSelect">
        <option value="">(loading…)</option>
      </select>
      <button id="clearPersonaBtn" type="button">Clear Persona</button>
    </div>

    <div class="spacer"></div>

    <div class="col">
      <label for="searchInput">Search (name + game text):</label>
      <input id="searchInput" type="search" placeholder="Try: 'Momentum', 'Submission', 'Cheap Pop', etc." />
    </div>

    <div class="row" style="margin-top:10px;">
      <div class="col">
        <label for="typeFilter">Type:</label>
        <select id="typeFilter">
          <option value="">All</option>
        </select>
      </div>

      <div class="col">
        <label for="setFilter">Set:</label>
        <select id="setFilter">
          <option value="">All</option>
        </select>
      </div>

      <div class="col">
        <label>&nbsp;</label>
        <button id="clearFiltersBtn" type="button">Clear Filters</button>
      </div>
    </div>

    <p class="muted" id="poolSummary" style="margin-top:10px;">
      Card Pool excludes any card with <b>Starting For</b> filled, and excludes Kits.
    </p>

    <h2>Starter / Kit cards for selected Persona</h2>
    <div id="starterGrid" class="grid">
      <div class="muted">Loading…</div>
    </div>

    <h2>General Card Pool (no Kits, no Starters)</h2>
    <div id="poolGrid" class="grid">
      <div class="muted">Loading…</div>
    </div>

    <div class="row" style="margin: 14px 0 22px;">
      <button id="showMoreBtn" type="button">Show more</button>
      <span class="muted" id="showMoreHint"></span>
    </div>
  </main>

  <div class="toastWrap" id="toastWrap" style="display:none;">
    <div class="toast">
      <div class="toastHead">
        <div>
          <div class="toastTitle" id="toastTitle">App Error</div>
          <div class="muted" id="toastTime" style="color:#bbb;font-size:12px;"></div>
        </div>
        <div class="toastBtns">
          <button id="toastCopyBtn" type="button">Copy</button>
          <button id="toastCloseBtn" type="button">Close</button>
        </div>
      </div>
      <pre id="toastBody"></pre>
    </div>
  </div>

  <script>
    // FILE: index.html
    (function () {
      const statusLine = document.getElementById("statusLine");

      function setStatus(text) {
        if (statusLine) statusLine.textContent = text;
      }

      const toastWrap = document.getElementById("toastWrap");
      const toastTitle = document.getElementById("toastTitle");
      const toastTime = document.getElementById("toastTime");
      const toastBody = document.getElementById("toastBody");
      const toastCopyBtn = document.getElementById("toastCopyBtn");
      const toastCloseBtn = document.getElementById("toastCloseBtn");

      function showToast(title, body) {
        toastTitle.textContent = title || "App Error";
        toastTime.textContent = new Date().toLocaleTimeString();
        toastBody.textContent = body || "";
        toastWrap.style.display = "flex";

        toastCopyBtn.onclick = async () => {
          const text = `${toastTitle.textContent}\n\n${toastBody.textContent}`;
          try { await navigator.clipboard.writeText(text); } catch (e) {}
        };
        toastCloseBtn.onclick = () => { toastWrap.style.display = "none"; };
      }

      function showError(title, err) {
        const msg = err && err.stack ? err.stack : String(err ?? "");
        setStatus("Status: ERROR (see popup)  Sets: (loading)  Cards: (loading)");
        try { showToast(title || "App Error", msg); }
        catch (e) { alert((title || "App Error") + "\n\n" + msg); }
      }

      window.AEWDBG = { setStatus, showError };

      window.addEventListener("error", (ev) => {
        showError("Uncaught error", ev.error || ev.message || ev);
      });

      window.addEventListener("unhandledrejection", (ev) => {
        showError("Unhandled rejection", ev.reason || ev);
      });

      (async () => {
        setStatus("Status: Loading…  Sets: (loading)  Cards: (loading)");
        try {
          const mod = await import("./renderer.js");
          if (!mod || typeof mod.initApp !== "function") {
            throw new Error("renderer.js loaded, but did not export initApp()");
          }
          await mod.initApp();
        } catch (e) {
          showError("Boot failed (module load/import).", e);
        }
      })();
    })();
  </script>
</body>
</html>
